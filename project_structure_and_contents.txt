Project structure
-----------------
./
    requirements.txt
    .gitignore
    app.py
    app.yaml
    .gcloudignore
    __pycache__/
        app.cpython-310.pyc
    templates/
        manage_categories.html
        edit_question.html
        index.html
        register.html
        change_password.html
        login.html
    static/
        styles.css

./
    requirements.txt
    ----------------
    # # Flask==2.1.2
    # Flask==3.0.3
    # Flask-Login==0.6.2
    # matplotlib==3.5.2
    # # Werkzeug==2.1.2
    # Werkzeug==3.0.3
    # gunicorn==20.1.0
    # google-cloud-storage==2.2.0
    # cryptography==3.4.8
    
    Flask==3.0.3
    Flask-Login==0.6.3
    matplotlib==3.8.3
    werkzeug==3.0.3

    .gitignore
    ----------
    __pycache__/
    google-cloud-sdk
    google-cloud-cli-478.0.0-linux-x86_64.tar.gz

    app.py
    ------
    from flask import Flask, render_template, request, redirect, flash, url_for, send_file, jsonify
    from flask_login import LoginManager, UserMixin, login_user, login_required, logout_user, current_user
    import json
    import os
    import matplotlib.pyplot as plt
    import matplotlib.font_manager as fm
    from io import BytesIO
    import base64
    from werkzeug.security import generate_password_hash, check_password_hash
    from datetime import datetime
    
    
    app = Flask(__name__)
    app.secret_key = 'your_secret_key'
    
    
    login_manager = LoginManager()
    login_manager.init_app(app)
    login_manager.login_view = 'login'
    
    
    DATA_FILE = 'data.json'
    USERS_FILE = 'users.json'
    VOC_FILE = 'voc.json'
    CATEGORIES_FILE = 'categories.json'
    FONT_PATH = 'templates/NanumGothic.ttf'
    
    
    if not os.path.exists(DATA_FILE):
       with open(DATA_FILE, 'w', encoding='utf-8') as f:
           json.dump([], f, ensure_ascii=False, indent=4)
    
    
    if not os.path.exists(USERS_FILE):
       with open(USERS_FILE, 'w', encoding='utf-8') as f:
           json.dump([], f, ensure_ascii=False, indent=4)
    
    
    if not os.path.exists(VOC_FILE):
       with open(VOC_FILE, 'w', encoding='utf-8') as f:
           json.dump([], f, ensure_ascii=False, indent=4)
    
    
    if not os.path.exists(CATEGORIES_FILE):
       with open(CATEGORIES_FILE, 'w', encoding='utf-8') as f:
           json.dump({'categories': []}, f, ensure_ascii=False, indent=4)
    
    
    class User(UserMixin):
       def __init__(self, id):
           self.id = id
           self.password_hash = None
    
    
       @staticmethod
       def get(user_id):
           with open(USERS_FILE, 'r', encoding='utf-8') as f:
               users = json.load(f)
           user = next((u for u in users if u['id'] == user_id), None)
           if user:
               user_obj = User(user['id'])
               user_obj.password_hash = user['password']
               return user_obj
           return None
    
    
       def set_password(self, password):
           self.password_hash = generate_password_hash(password)
    
    
       def check_password(self, password):
           return check_password_hash(self.password_hash, password)
    
    
    @login_manager.user_loader
    def load_user(user_id):
       return User.get(user_id)
    
    
    def autopct_format(values):
       def my_format(pct):
           total = sum(values)
           val = int(round(pct*total/100.0))
           return f'{pct:.1f}%\n({val:d})'
       return my_format
    
    
    def generate_category_pie_chart(data):
        category_count = {}
        total_questions = len(data)
        for question in data:
            if 'Category' in question and 'main' in question['Category']:
                category = question['Category']['main'] if question['Category']['main'] else 'ÎØ∏Î∂ÑÎ•ò'
                if category in category_count:
                    category_count[category] += 1
                else:
                    category_count[category] = 1
    
        labels = list(category_count.keys())
        sizes = list(category_count.values())
    
        fontprop = fm.FontProperties(fname=FONT_PATH, size=12)
    
        plt.figure(figsize=(6, 6))
        plt.pie(sizes, labels=labels, autopct=autopct_format(sizes), startangle=140)
    
        # ÎùºÎ≤®Ïóê Ìè∞Ìä∏ Ï†ÅÏö©
        for label in plt.gca().texts:
            label.set_fontproperties(fontprop)
    
        plt.tight_layout()
        img = BytesIO()
        plt.savefig(img, format='png')
        img.seek(0)
        img_base64 = base64.b64encode(img.getvalue()).decode()
        plt.close()
        return img_base64
    
    
    
    
    
    @app.route('/')
    @login_required
    def index():
        with open(DATA_FILE, 'r', encoding='utf-8') as f:
            data = json.load(f)
        if current_user.id == 'admin':
            user_questions = data
        else:
            user_questions = [q for q in data if q['SubmitterID'] == current_user.id]
    
        last_type = request.cookies.get('last_type')
        last_category = {
            'main': request.cookies.get('last_main_category', ''),
            'sub': request.cookies.get('last_sub_category', ''),
            'minor': request.cookies.get('last_minor_category', '')
        }
        last_tags = request.cookies.get('last_tags')
        last_source = request.cookies.get('last_source', '')
    
        for question in user_questions:
            if 'Source' not in question:
                question['Source'] = 'Ï∂úÏ≤ò ÏóÜÏùå'
            if 'SubmissionTime' not in question:
                question['SubmissionTime'] = 'N/A'
            if 'LastModifiedTime' not in question or not question['LastModifiedTime']:
                question['LastModifiedTime'] = 'ÏàòÏ†ïÎêòÏßÄ ÏïäÏùå'
    
        chart_base64 = generate_category_pie_chart(data)  # Ï†ÑÏ≤¥ Î¨∏Ï†ú Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©
        return render_template('index.html', questions=user_questions, user=current_user, last_type=last_type, last_category=last_category, last_tags=last_tags, last_source=last_source, chart_base64=chart_base64, total_questions=len(data))
    
    
    
    
    
    @app.route('/register', methods=['GET', 'POST'])
    def register():
       if request.method == 'POST':
           user_id = request.form['user_id']
           password = request.form['password']
           user = User.get(user_id)
           if user is not None:
               flash('User ID already exists.', 'error')
           else:
               user = User(user_id)
               user.set_password(password)
               with open(USERS_FILE, 'r', encoding='utf-8') as f:
                   users = json.load(f)
               users.append({'id': user_id, 'password': user.password_hash})
               with open(USERS_FILE, 'w', encoding='utf-8') as f:
                   json.dump(users, f, ensure_ascii=False, indent=4)
               flash('User registered successfully!', 'success')
               return redirect(url_for('login'))
       return render_template('register.html')
    
    
    @app.route('/login', methods=['GET', 'POST'])
    def login():
       if request.method == 'POST':
           user_id = request.form['user_id']
           password = request.form['password']
           user = User.get(user_id)
           if user is None or not user.check_password(password):
               flash('Invalid user ID or password.', 'error')
           else:
               login_user(user)
               response = redirect(url_for('index'))
               response.set_cookie('last_type', '', expires=0)
               response.set_cookie('last_main_category', '', expires=0)
               response.set_cookie('last_sub_category', '', expires=0)
               response.set_cookie('last_minor_category', '', expires=0)
               response.set_cookie('last_tags', '', expires=0)
               return response
       return render_template('login.html')
    
    # @app.route('/login', methods=['GET', 'POST'])
    # def login():
    #     if request.method == 'POST':
    #         try:
    #             user_id = request.form['user_id']
    #             password = request.form['password']
    #             user = User.get(user_id)
    #             if user is None or not user.check_password(password):
    #                 flash('Invalid user ID or password.', 'error')
    #                 return redirect(url_for('login'))
    #             login_user(user)
    #             return redirect(url_for('index'))
    #         except Exception as e:
    #             flash(f'An error occurred: {str(e)}', 'error')
    #             return redirect(url_for('login'))
    #     return render_template('login.html')
    
    
    @app.route('/logout')
    @login_required
    def logout():
       logout_user()
       response = redirect(url_for('login'))
       response.set_cookie('last_type', '', expires=0)
       response.set_cookie('last_main_category', '', expires=0)
       response.set_cookie('last_sub_category', '', expires=0)
       response.set_cookie('last_minor_category', '', expires=0)
       response.set_cookie('last_tags', '', expires=0)
       return response
    
    
    from werkzeug.utils import secure_filename
    
    UPLOAD_FOLDER = '/tmp/image_data'
    if not os.path.exists(UPLOAD_FOLDER):
        os.makedirs(UPLOAD_FOLDER)
    
    def save_image(file, filename):
        if file:
            folder_path = os.path.join(app.config['UPLOAD_FOLDER'], str(filename.split('_')[-1].split('.')[0]))
            if not os.path.exists(folder_path):
                os.makedirs(folder_path)
            filepath = os.path.join(folder_path, filename)
            file.save(filepath)
            return filepath
        return None
    
    @app.route('/submit', methods=['POST'])
    @login_required
    def submit_question():
        question_type = request.form['question_type']
        choices = []
    
        if question_type == 'multiple':
            question = request.form['mc_question']
            choices = request.form.getlist('mc_choices[]')
            answers = request.form.getlist('mc_answers[]')
        elif question_type == 'subjective':
            question = request.form['sub_question']
            answer = request.form['sub_answer']
            answers = [answer]
        elif question_type == 'fill_in_the_blank':
            question = request.form['fib_question']
            raw_answers = request.form.getlist('fib_answer[]')
            others = request.form.getlist('fib_others[]')
            answers = {f"Blank#{i + 1}": answer for i, answer in enumerate(raw_answers)}
            for i, other in enumerate(others):
                answers[f"other#{i + 1}"] = other  # Add each other choice with a unique key
    
        main_category = request.form['main_category']
        sub_category = request.form['sub_category']
        minor_category = request.form['minor_category']
        tags = request.form['tags']
        source = request.form['source']
    
        try:
            with open(DATA_FILE, 'r', encoding='utf-8') as f:
                data = json.load(f)
    
            new_id = max([item['ID'] for item in data], default=0) + 1 if data else 1
    
            new_data = {
                'ID': new_id,
                'Type': question_type,
                'Question': question,
                'Choices': choices,
                'Answers': answers,
                'SubmitterID': current_user.id,
                'Category': {
                    'main': main_category,
                    'sub': sub_category,
                    'minor': minor_category
                },
                'Tags': tags,
                'Source': source,
                'SubmissionTime': datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
                'LastModifiedTime': ''
            }
    
            data.append(new_data)
    
            with open(DATA_FILE, 'w', encoding='utf-8') as f:
                json.dump(data, f, ensure_ascii=False, indent=4)
    
            flash('Question successfully submitted!', 'success')
            response = redirect(url_for('index'))
            response.set_cookie('last_type', question_type)
            response.set_cookie('last_main_category', main_category)
            response.set_cookie('last_sub_category', sub_category)
            response.set_cookie('last_minor_category', minor_category)
            response.set_cookie('last_tags', tags)
            return response
        except Exception as e:
            flash(f'An error occurred while submitting the question: {e}', 'error')
    
        return redirect(url_for('index'))
    
    
    
    @app.route('/edit/<int:question_id>', methods=['GET', 'POST'])
    @login_required
    def edit_question(question_id):
        with open(DATA_FILE, 'r', encoding='utf-8') as f:
            data = json.load(f)
        
        # Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùå
        question = next((q for q in data if q['ID'] == question_id and (q['SubmitterID'] == current_user.id or current_user.id == 'admin')), None)
        
        if question is None:
            flash('Question not found or you do not have permission to edit it.', 'error')
            return redirect(url_for('index'))
        
        if request.method == 'POST':
            question_type = request.form['question_type']
            new_question = {}
            
            # Ìèº Îç∞Ïù¥ÌÑ∞Î•º Î∞îÌÉïÏúºÎ°ú ÏÉàÎ°úÏö¥ Îç∞Ïù¥ÌÑ∞Î•º ÏÉùÏÑ±
            if question_type == 'multiple':
                new_question = {
                    'Question': request.form['mc_question'],
                    'Choices': request.form.getlist('mc_choices[]'),
                    'Answers': request.form.getlist('mc_answers[]')
                }
            elif question_type == 'subjective':
                new_question = {
                    'Question': request.form['sub_question'],
                    'Answers': [request.form['sub_answer']],
                    'Choices': None
                }
            elif question_type == 'fill_in_the_blank':
                raw_answers = request.form.getlist('fib_answer[]')
                other_choices = request.form.getlist('fib_others[]')
                answers = {f"Blank#{i + 1}": answer for i, answer in enumerate(raw_answers)}
                for i, other in enumerate(other_choices):
                    answers[f"other#{i + 1}"] = other  # Add each other choice with a unique key
                
                new_question = {
                    'Question': request.form['fib_question'],
                    'Answers': answers,
                    'Choices': None
                }
            
            # Ïπ¥ÌÖåÍ≥†Î¶¨, ÌÉúÍ∑∏, Ï∂úÏ≤ò, ÏãúÍ∞Ñ Ï†ïÎ≥¥ Îì±ÏùÑ ÏÑ§Ï†ï
            new_question.update({
                'ID': question['ID'],  # Í∏∞Ï°¥ ID Ïú†ÏßÄ
                'Type': question_type,
                'SubmitterID': current_user.id,
                'Category': {
                    'main': request.form['main_category'],
                    'sub': request.form['sub_category'],
                    'minor': request.form['minor_category']
                },
                'Tags': request.form['tags'],
                'Source': request.form['source'],
                'SubmissionTime': question['SubmissionTime'],  # Í∏∞Ï°¥ Ï†úÏ∂ú ÏãúÍ∞Ñ Ïú†ÏßÄ
                'LastModifiedTime': datetime.now().strftime('%Y-%m-%d %H:%M:%S')  # ÌòÑÏû¨ ÏãúÍ∞ÑÏúºÎ°ú ÏàòÏ†ï ÏãúÍ∞Ñ ÏÑ§Ï†ï
            })
            
            # Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Î•º ÎçÆÏñ¥Ïì∞ÏßÄ ÏïäÍ≥† ÏÉàÎ°úÏö¥ Îç∞Ïù¥ÌÑ∞Î•º ÏÉùÏÑ±ÌïòÏó¨ Î¶¨Ïä§Ìä∏Ïóê Ï†ÄÏû•
            data = [q if q['ID'] != question_id else new_question for q in data]
            
            # Îç∞Ïù¥ÌÑ∞ ÌååÏùºÏóê Ï†ÄÏû•
            with open(DATA_FILE, 'w', encoding='utf-8') as f:
                json.dump(data, f, ensure_ascii=False, indent=4)
            
            flash('Question successfully updated!', 'success')
            return redirect(url_for('index'))
        
        return render_template('edit_question.html', question=question)
    
    
    
    
    
    
    
    
    import shutil
    
    @app.route('/delete/<int:question_id>', methods=['POST'])
    @login_required
    def delete_question(question_id):
        try:
            with open(DATA_FILE, 'r', encoding='utf-8') as f:
                data = json.load(f)
            question = next((q for q in data if q['ID'] == question_id and (q['SubmitterID'] == current_user.id or current_user.id == 'admin')), None)
            if question:
                folder_path = os.path.join(app.config['UPLOAD_FOLDER'], str(question_id))
                if os.path.exists(folder_path):
                    shutil.rmtree(folder_path)
                data = [q for q in data if q['ID'] != question_id]
                with open(DATA_FILE, 'w', encoding='utf-8') as f:
                    json.dump(data, f, ensure_ascii=False, indent=4)
                flash('Question and associated images successfully deleted!', 'success')
            else:
                flash('Question not found or you do not have permission to delete it.', 'error')
        except Exception as e:
            flash(f'An error occurred while deleting the question: {e}', 'error')
        return redirect(url_for('index'))
    
    @app.route('/delete_image', methods=['POST'])
    @login_required
    def delete_image():
        try:
            data = request.get_json()
            question_id = data['question_id']
            image_type = data['image_type']
            filename_map = {
                'question_image': f'img_question_{question_id}.png',
                'answer_image': f'img_answer_{question_id}.png'
            }
            if 'choice_image_' in image_type:
                choice_num = image_type.split('_')[2]
                filename_map[image_type] = f'img_choice_{choice_num}_{question_id}.png'
            image_path = os.path.join(app.config['UPLOAD_FOLDER'], str(question_id), filename_map[image_type])
            if os.path.exists(image_path):
                os.remove(image_path)
            return jsonify(success=True)
        except Exception as e:
            return jsonify(success=False, error=str(e))
    
    
    
    @app.route('/submit_voc', methods=['POST'])
    @login_required
    def submit_voc():
       voc_type = request.form['voc_type']
       voc_content = request.form['voc_content']
    
    
       new_voc = {
           'Type': voc_type,
           'Content': voc_content,
           'SubmitterID': current_user.id
       }
    
    
       try:
           with open(VOC_FILE, 'r', encoding='utf-8') as f:
               voc_data = json.load(f)
          
           voc_data.append(new_voc)
          
           with open(VOC_FILE, 'w', encoding='utf-8') as f:
               json.dump(voc_data, f, ensure_ascii=False, indent=4)
    
    
           flash('VOC successfully submitted!', 'success')
       except Exception as e:
           flash(f'An error occurred while submitting the VOC: {e}', 'error')
      
       return redirect(url_for('index'))
    
    
    @app.route('/download_voc')
    @login_required
    def download_voc():
       return send_file(VOC_FILE, as_attachment=True)
    
    
    @app.route('/download')
    @login_required
    def download():
       return send_file(DATA_FILE, as_attachment=True)
    
    
    @app.route('/download_users')
    @login_required
    def download_users():
       if current_user.id == 'admin':
           return send_file(USERS_FILE, as_attachment=True)
       else:
           flash('You do not have permission to download this file.', 'error')
           return redirect(url_for('index'))
    
    
    @app.route('/download_categories')
    @login_required
    def download_categories():
       return send_file(CATEGORIES_FILE, as_attachment=True)
    
    
    @app.route('/categories', methods=['GET'])
    @login_required
    def get_categories():
       with open(CATEGORIES_FILE, 'r', encoding='utf-8') as f:
           categories = json.load(f)
       return jsonify(categories)
    
    
    @app.route('/manage_categories', methods=['GET', 'POST'])
    @login_required
    def manage_categories():
       if current_user.id != 'admin':
           flash('You do not have permission to manage categories.', 'error')
           return redirect(url_for('index'))
    
    
       if request.method == 'POST':
           categories_content = request.form['categories_content']
           try:
               categories = json.loads(categories_content)
               with open(CATEGORIES_FILE, 'w', encoding='utf-8') as f:
                   json.dump(categories, f, ensure_ascii=False, indent=4)
               flash('Categories updated successfully!', 'success')
           except json.JSONDecodeError:
               flash('Invalid JSON format.', 'error')
      
       with open(CATEGORIES_FILE, 'r', encoding='utf-8') as f:
           categories = json.load(f)
       return render_template('manage_categories.html', categories=json.dumps(categories, ensure_ascii=False, indent=4))
    
    
    @app.route('/change_password', methods=['GET', 'POST'])
    @login_required
    def change_password():
       if request.method == 'POST':
           old_password = request.form['old_password']
           new_password = request.form['new_password']
           confirm_password = request.form['confirm_password']
    
    
           user = User.get(current_user.id)
    
    
           if not user.check_password(old_password):
               flash('Old password is incorrect.', 'error')
           elif new_password != confirm_password:
               flash('New passwords do not match.', 'error')
           else:
               user.set_password(new_password)
               with open(USERS_FILE, 'r', encoding='utf-8') as f:
                   users = json.load(f)
               for u in users:
                   if u['id'] == user.id:
                       u['password'] = user.password_hash
                       break
               with open(USERS_FILE, 'w', encoding='utf-8') as f:
                   json.dump(users, f, ensure_ascii=False, indent=4)
               flash('Password changed successfully!', 'success')
               return redirect(url_for('index'))
       return render_template('change_password.html')
    
    
    if __name__ == '__main__':
       app.run(debug=True,port=4444)

    app.yaml
    --------
    runtime: python310  # ÎòêÎäî ÏÇ¨Ïö© Ï§ëÏù∏ Python Î≤ÑÏ†Ñ
    
    entrypoint: gunicorn -w 2 -b :$PORT app:app
    
    handlers:
    - url: /static
      static_dir: static
    
    - url: /.*
      script: auto

    .gcloudignore
    -------------
    # This file specifies files that are *not* uploaded to Google Cloud
    # using gcloud. It follows the same syntax as .gitignore, with the addition of
    # "#!include" directives (which insert the entries of the given .gitignore-style
    # file at that point).
    #
    # For more information, run:
    #   $ gcloud topic gcloudignore
    #
    .gcloudignore
    # If you would like to upload your .git directory, .gitignore file or files
    # from your .gitignore file, remove the corresponding line
    # below:
    .git
    .gitignore
    google-cloud-sdk
    google-cloud-cli-478.0.0-linux-x86_64.tar.gz
    
    
    # Python pycache:
    __pycache__/
    # Ignored by the build system
    /setup.cfg

    __pycache__/
        app.cpython-310.pyc
        -------------------
        o
        
            nf&K                     @   s4  d dl mZmZmZmZmZmZmZmZ d dl	m
        Z
        m
        Z
        m
        Z
        m
        Z
        mZmZ d dlZd dlZd dlmZ d dlmZ d dlmZ d dlZd dlm
        Z
        m
        Z
         d dl
        m
        Z
         eeZ de _!e
         Z"e"#e  de"_$d	Z%d
        Z&d
        Z'd
        Z(d
        Z)ej*+e%se,e%dddZ-ej.g e-ddd W d   n1 sw   Y  ej*+e&se,e&dddZ-ej.g e-ddd W d   n1 sw   Y  ej*+e'se,e'dddZ-ej.g e-ddd W d   n1 sw   Y  ej*+e(se,e(dddZ-ej.dg ie-ddd W d   n	1 sw   Y  G dd de
        Z/e"j0dd Z1dd Z2dd
         Z3e 4d
        e
        d
        d Z5e j4d d!d"gd#d$d% Z6e j4d&d!d"gd#d'd Z7e 4d(e
        d)d* Z8d d+l9m:Z: d,Z;ej*+e;sce<e; d-d. Z=e j4d/d"gd#e
        d0d1 Z>e j4d2d!d"gd#e
        d3d4 Z?d dl@Z@e j4d5d"gd#e
        d6d7 ZAe j4d8d"gd#e
        d9d: ZBe j4d;d"gd#e
        d<d= ZCe 4d>e
        d?d@ ZDe 4dAe
        dBdC ZEe 4dDe
        dEdF ZFe 4dGe
        dHdI ZGe j4dJd!gd#e
        dKdL ZHe j4dMd!d"gd#e
        dNdO ZIe j4dPd!d"gd#e
        dQdR ZJedSkre jKdTdUdV dS dS )W    )Flaskrender_templaterequestredirectflashurl_for	send_filejsonify)
        LoginManager	UserMixin
        login_userlogin_required
        logout_user
        current_userN)BytesIO)generate_password_hashcheck_password_hash)datetimeZyour_secret_keyloginz	data.jsonz
        users.jsonzvoc.jsonzcategories.jsonztemplates/NanumGothic.ttfwutf-8encodingF   
        ensure_asciiindent
        categoriesc                   @   s0   e Zd Zdd Zedd Zdd Zdd Zd	S )
        Userc                 C   s   || _ d | _d S N)id
        password_hash)selfr     r#   #/workspaces/codespaces-flask/app.py__init__2   s   
        z
        User.__init__c                    sr   t tddd
        }t|}W d    n1 sw   Y  t fdd|D d }|r7t|d }|d |_|S d S )Nrr   r   c                 3   s     | ]
        }|d   kr|V  qdS )r    Nr#   ).0uuser_idr#   r$   	<genexpr>;   s   
         zUser.get.<locals>.<genexpr>r    password)open
        USERS_FILEjsonloadnextr
           r!   )r*   fusersuserZuser_objr#   r)   r$   get7   s   
        
        
        
        zUser.getc                 C   s   t || _d S r   )r   r!   r"   r,   r#   r#   r$   
        set_passwordC   s   zUser.set_passwordc                 C   s
           t | j|S r   )r   r!   r6   r#   r#   r$   check_passwordG   s   
        zUser.check_passwordN)__name__
        __module__
        __qualname__r%   
        staticmethodr5   r7   r8   r#   r#   r#   r$   r
           1   s
            
        
        
        r
           c                 C   s
           t | S r   )r
           r5   r)   r#   r#   r$   	load_userK   s   
        r=   c                    s    fdd}|S )Nc                    s0   t  }tt| | d }| dd|ddS )Ng      Y@z.1fz%
        (d))sumintround)Zpcttotalvalvaluesr#   r$   	my_formatQ   s   z!autopct_format.<locals>.my_formatr#   )rF   rG   r#   rE   r$   autopct_formatP   s   
        rH   c           
              C   s  i }t | }| D ]+}d|v r3d|d v r3|d d r |d d nd}||v r/||  d7  < qd||< qt| }t| }tjtdd}tjdd tj	||t
        |d	d
         t
         j
        D ]}|
        | q]t  t }	tj|	d
        d
         |	d
         t|	  }
        t  |
        S )NCategorymainu	   ÎØ∏Î∂ÑÎ•ò   
           )fnamesize)   rO   )Zfigsize   )labelsZautopctZ
        startangleZpng)formatr   )lenlistkeysrF   fmZFontProperties	FONT_PATHpltZfigureZpierH   ZgcaZtextsZset_fontpropertiesZ
        tight_layoutr   Zsavefigseekbase64	b64encodegetvaluedecodeclose)
        dataZcategory_counttotal_questionsquestioncategoryrQ   ZsizesZfontproplabelZimgZ
        img_base64r#   r#   r$   generate_category_pie_chartX   s.   
        
        
        
        
        
        rd   /c            	   
           C   s  t tddd
        } t| }W d    n1 sw   Y  tjdkr$|}ndd |D }tjd}tjdd	tjd
        d	tjd
        d	d
        }tjd
        }tjdd	}|D ]
        }d|vr_d|d< d|vrgd|d< d|vso|d ssd|d< qUt	|}t
        d|t|||||t
        |d	S )Nr&   r   r   adminc                 S   s
           g | ]
        }|d  t jkr|qS )
        SubmitterIDr   r    r'   qr#   r#   r$   
        <listcomp>   s   
         zindex.<locals>.<listcomp>	last_typelast_main_category last_sub_categorylast_minor_categoryrJ   subminor	last_tags
        last_sourceSourceu
           Ï∂úÏ≤ò ÏóÜÏùåSubmissionTimezN/ALastModifiedTimeu   ÏàòÏ†ïÎêòÏßÄ ÏïäÏùåz
        index.html)Z	questionsr4   rl   
        last_categoryrt   ru   
        chart_base64r`   )
        r-   	DATA_FILEr/   r0   r   r    r   cookiesr5   rd   r   rS   )	r2   r_   Zuser_questionsrl   ry   rt   ru   ra   rz   r#   r#   r$   index{   s.   
        
        
        
        
        
        
        
        
        r}   z	/registerGETPOST)methodsc                  C   s   t jdkrzt jd } t jd }t| }|d ur!tdd tdS t| }|| ttddd
        }t	
        |}W d    n1 sAw   Y  |
        | |j
        d	 ttd
        dd}t	j
        ||d
        d
        d
         W d    n1 sjw   Y  tdd ttdS tdS )Nr   r*   r,   zUser ID already exists.errorr&   r   r   )r    r,   r   Fr   r   z
        User registered successfully!successr   z
        register.html)r   methodformr
           r5   r   r7   r-   r.   r/   r0   appendr!   dumpr   r   r   )r*   r,   r4   r2   r3   r#   r#   r$   register   s&   
        
        
        
        
        
        
        
        
        
        
        
        r   z/loginc                  C   s   t jdkrZt jd } t jd }t| }|d u s
        ||s&tdd t
        dS t| tt	d}|j
        ddd	d
         |j
        d
        dd	d
         |j
        d
        dd	d
         |j
        d
        dd	d
         |j
        ddd	d
         |S t
        dS )Nr   r*   r,   z
        Invalid user ID or password.r   r}   rl   rn   r   expiresrm   ro   rp   rt   z
        login.html)
        r   r   r   r
           r5   r8   r   r
           r   r   
        set_cookier   )r*   r,   r4   responser#   r#   r$   r      s    
        
        
        
        
        
        
        z/logoutc                  C   sf   t   ttd} | jdddd | jdddd | jdddd | jdddd | jd	ddd | S )
        Nr   rl   rn   r   r   rm   ro   rp   rt   )r   r   r   r   )r   r#   r#   r$   logout   s   
        r   )secure_filenamez/tmp/image_datac                 C   sf   | r1t jtjd t|dd dd }t j|s#t | t j||}| 	| |S d S )N
        UPLOAD_FOLDER_.r   )
        ospathjoinappconfigstrsplitexistsmakedirssave)filefilename
        folder_pathfilepathr#   r#   r$   
        save_image   s   ,
        
        
        r   z/submitc               
           C   s`  t jd } g }| dkr
        t jd }t jd}t jd}nB| dkr/t jd }t jd }|g}n0| d	kr_t jd
         }t jd
        }t jd
        }d
        d t|D }t|D ]
        \}}||d|d  < qQt jd }	t jd }
        t jd }
        t jd }
        t jd }
        zttddd
        }t|}W d    n1 sw   Y  |rtdd |D dd
        d nd}|| |||t	j
        |	|
        |
        d
        |
        |
        t
        
         
        d
        dd 
        }|| ttd!dd}tj||d"d#d$ W d    n1 sw   Y  td%d& ttd'}|d(|  |d)|	 |d*|
         |d+|
         |d,|
         |W S  ty) } ztd-| d. W Y d }~nd }~ww ttd'S )/N
        question_typemultiple
        mc_question
        mc_choices[]
        mc_answers[]
        subjective
        sub_question
        sub_answerfill_in_the_blank
        fib_question
        fib_answer[]
        fib_others[]c                 S       i | ]
        \}}d |d  |qS zBlank#rK   r#   r'   ianswerr#   r#   r$   
        <dictcomp>       z#submit_question.<locals>.<dictcomp>other#rK   
        main_category
        sub_categoryminor_categorytagssourcer&   r   r   c                 S   s   g | ]}|d  qS IDr#   )r'   itemr#   r#   r$   rk     s    z#submit_question.<locals>.<listcomp>r   )defaultrq   %Y-%m-%d %H:%M:%Srn   )
        r   TypeQuestionChoicesAnswersrg   rI   Tagsrv   rw   rx   r   Fr   r   z Question successfully submitted!r   r}   rl   rm   ro   rp   rt   z1An error occurred while submitting the question: r   )r   r   getlist	enumerater-   r{   r/   r0   maxr   r    r   nowstrftimer   r   r   r   r   r   	Exception)r   choicesra   answersr   
        raw_answersZothersr   otherr   r   r   r   r   r2   r_   Znew_idZnew_datar   er#   r#   r$   submit_question   sv   
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        "
        
        
        
        
        
        
        
        
        
        
        
        r   z/edit/<int:question_id>c           
           
              s
          t tddd
        }t|}W d    n1 sw   Y  tfdd|D d }|d u r7tdd ttdS tj	d	krtj
        d
         }i  |d
        krYtj
        d
         tj
        
        d
        tj
        
        dd nF|dkrktj
        d tj
        d gd d n4|dkrtj
        
        d}tj
        
        d}dd t
        |D }t
        |D ]
        \}}	|	|d|d  < qtj
        d |d d  
        |d
         |tjtj
        d
         tj
        d
         tj
        d d tj
        d! tj
        d" |d# t d$d%  fd&d'|D }t td(dd}tj||d)d*d+ W d    n1 sw   Y  td,d- ttdS td.|d/S )0Nr&   r   r   c                 3   8    | ]}|d   kr|d t jkst jdkr|V  qdS r   rg   rf   Nrh   ri   
        question_idr#   r$   r+   C     6 z edit_question.<locals>.<genexpr>z<Question not found or you do not have permission to edit it.r   r}   r   r   r   r   r   r   )r   r   r   r   r   r   )r   r   r   r   r   r   c                 S   r   r   r#   r   r#   r#   r$   r   ]  r   z!edit_question.<locals>.<dictcomp>r   rK   r   r   r   r   r   rq   r   r   rw   r   )r   r   rg   rI   r   rv   rw   rx   c                    s    g | ]
        }|d  kr
        |n qS r   r#   ri   Z
        new_questionr   r#   r$   rk   x  r   z!edit_question.<locals>.<listcomp>r   Fr   r   z
        Question successfully updated!r   zedit_question.html)ra   )r-   r{   r/   r0   r1   r   r   r   r   r   r   r   r   updater   r    r   r   r   r   r   )
        r   r2   r_   ra   r   r   Z
        other_choicesr   r   r   r#   r   r$   
        edit_question<  sd   
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        r   z/delete/<int:question_id>c              
              s0  zwt tddd
        }t|}W d    n1 sw   Y  t fdd|D d }|rqtjtj	d t
         }tj
        |rBt
        
        |  fdd|D }t td	dd}tj||d
        d
        d
         W d    n1 sfw   Y  td
        d ntdd W n ty } ztd| d W Y d }~nd }~ww ttdS )Nr&   r   r   c                 3   r   r   rh   ri   r   r#   r$   r+     r   z"delete_question.<locals>.<genexpr>r   c                    s
           g | ]
        }|d   kr|qS r   r#   ri   r   r#   r$   rk     s   
         z#delete_question.<locals>.<listcomp>r   Fr   r   z4Question and associated images successfully deleted!r   z>Question not found or you do not have permission to delete it.r   z/An error occurred while deleting the question: r}   )r-   r{   r/   r0   r1   r   r   r   r   r   r   r   shutilrmtreer   r   r   r   r   )r   r2   r_   ra   r   r   r#   r   r$   delete_question  s*   
        
        
        
        
        
        
        
        
        r   z
        /delete_imagec               
           C   s   zOt  } | d }| d }d| dd| dd}d|v r0|dd	 }d
        | d| d||< tjtjd
         t||| }tj	|rJt
        | t
        d
        d
        W S  t
        yi } zt
        dt|dW  Y d }~S d }~ww )Nr   
        image_typeZ
        img_question_z.pngZ
        img_answer_)Zquestion_imageZ
        answer_imageZ
        choice_image_r      Z
        img_choice_r   T)r   F)r   r   )
        r   get_jsonr   r   r   r   r   r   r   r   remover	   r   )r_   r   r   Z
        filename_mapZ
        choice_numZ
        image_pathr   r#   r#   r$   
        delete_image  s$   
        
        
        
        
        
        
        r   z
        /submit_vocc               
           C   s   t jd } t jd }| |tjd}zHttddd
        }t|}W d    n1 s)w   Y  || ttddd}tj	||dd	d
         W d    n1 sNw   Y  t
        d
        d
         W n t
        ys } zt
        d
        | d W Y d }~nd }~ww t
        t
        dS )Nvoc_type
        voc_content)r   ZContentrg   r&   r   r   r   Fr   r   zVOC successfully submitted!r   z,An error occurred while submitting the VOC: r   r}   )r   r   r   r    r-   VOC_FILEr/   r0   r   r   r   r   r   r   )r   r   Znew_vocr2   Zvoc_datar   r#   r#   r$   
        submit_voc  s(   
        
        
        
        
        
        
        
        r   z
        /download_vocc                   C   
           t tddS NT
        as_attachment)r   r   r#   r#   r#   r$   
        download_voc     
        r   z	/downloadc                   C   r   r   )r   r{   r#   r#   r#   r$   download  r   r   z/download_usersc                   C   s,   t jdkr
        ttddS tdd ttdS )Nrf   Tr   z1You do not have permission to download this file.r   r}   )r   r    r   r.   r   r   r   r#   r#   r#   r$   download_users  s   
        
        
        
        r   z/download_categoriesc                   C   r   r   )r   CATEGORIES_FILEr#   r#   r#   r$   download_categories  r   r   z
        /categoriesc                  C   sF   t tddd} t| }W d    t|S 1 sw   Y  t|S )Nr&   r   r   )r-   r   r/   r0   r	   )r2   r
           r#   r#   r$   get_categories  s
           
        
        r   z/manage_categoriesc                  C   s   t jdkrtdd ttdS tjdkrVtjd } z,t	| }t
        t
        ddd	}tj
        ||d
        d
        d
         W d    n1 s;w   Y  td
        d W n tj
        yU   tdd Y nw t
        t
        ddd	
        }t|}W d    n1 smw   Y  tdtj|d
        d
        d
        dS )Nrf   z0You do not have permission to manage categories.r   r}   r   categories_contentr   r   r   Fr   r   z Categories updated successfully!r   zInvalid JSON format.r&   zmanage_categories.html)r
           )r   r    r   r   r   r   r   r   r/   loadsr-   r   r   JSONDecodeErrorr0   r   dumps)r   r
           r2   r#   r#   r$   manage_categories  s$   
        
        
        
        
        
        
        
        
        r   z/change_passwordc                  C   s0  t jdkrt jd } t jd }t jd }ttj}|| s(tdd tdS ||kr5tdd tdS |	| t
        t
        dd	d
        
        }t
        
        |}W d    n1 sQw   Y  |D ]}|d
         |jkrh|j|d
        <  nqXt
        t
        d
        d	d
        }t
        j||ddd W d    n1 sw   Y  tdd ttdS tdS )Nr   
        old_password
        new_passwordconfirm_passwordzOld password is incorrect.r   zNew passwords do not match.r&   r   r   r    r,   r   Fr   r   z
        Password changed successfully!r   r}   zchange_password.html)r   r   r   r
           r5   r   r    r8   r   r7   r-   r.   r/   r0   r!   r   r   r   r   )r   r   r   r4   r2   r3   r(   r#   r#   r$   change_password  s4   
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        r   __main__Ti\  )debugport)Lflaskr   r   r   r   r   r   r   r	   Z
        flask_loginr
           r
           r
           r
           r   r   r/   r   Zmatplotlib.pyplotZpyplotrX   Zmatplotlib.font_managerZ
        font_managerrV   ior   rZ   Zwerkzeug.securityr   r   r   r9   r   
        secret_keyZ
        login_managerZinit_appZ
        login_viewr{   r.   r   r   rW   r   r   r-   r2   r   r
           Z
        user_loaderr=   rH   rd   router}   r   r   r   Zwerkzeug.utilsr   r   r   r   r   r   r   r   r   r   r   r   r   r   r   r   r   runr#   r#   r#   r$   <module>   s   (  
        
        
        
        
        
        
        
        
        
        
        
        
        #
         
        
        $
        
        
        
        
        
        F
        L
        
        
        
        
        
        
        
        
        
        
        
        
        

    templates/
        manage_categories.html
        ----------------------
        <!DOCTYPE html>
        <html lang="ko">
        <head>
           <meta charset="UTF-8">
           <title>Î∂ÑÎ•ò Í¥ÄÎ¶¨</title>
           <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
           <style>
               .button-group {
                   display: flex;
                   justify-content: space-between;
                   margin-top: 10px;
               }
               .button-group button,
               .button-group input[type="submit"] {
                   flex: 1;
                   margin-right: 10px;
               }
               .button-group button:last-child {
                   margin-right: 0;
               }
           </style>
        </head>
        <body>
           <div class="form-container">
               <h1>SSAT Ï∂úÏ†ú ÏãúÏä§ÌÖú</h1>
               <h1>Î∂ÑÎ•ò Í¥ÄÎ¶¨</h1>
        
        
               {% with messages = get_flashed_messages(with_categories=true) %}
                   {% if messages %}
                       <ul class="flashes">
                           {% for category, message in messages %}
                               <li class="{{ category }}">{{ message }}</li>
                           {% endfor %}
                       </ul>
                   {% endif %}
               {% endwith %}
        
        
               <form action="{{ url_for('manage_categories') }}" method="POST">
                   <label>Î∂ÑÎ•ò JSON:</label><br>
                   <textarea name="categories_content" rows="20" style="width: 100%;">{{ categories }}</textarea><br>
                   <div class="button-group">
                       <input type="submit" value="Ï†ÄÏû•">
                       <button type="button" onclick="window.location.href='{{ url_for('index') }}'">ÎÇòÍ∞ÄÍ∏∞</button>
                   </div>
               </form>
               <a href="{{ url_for('download_categories') }}" class="download-btn">Î∂ÑÎ•ò JSON Îã§Ïö¥Î°úÎìú</a>
           </div>
        </body>
        </html>

        edit_question.html
        ------------------
        <!DOCTYPE html>
        <html lang="ko">
        
        <head>
            <meta charset="UTF-8">
            <title>Î¨∏Ï†ú ÏàòÏ†ï</title>
            <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
            <style>
                .form-container {
                    max-width: 800px;
                    margin: 20px auto;
                    padding: 20px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    background-color: #fff;
                }
            </style>
            <script>
                function showForm() {
                    const type = document.querySelector('input[name="question_type"]:checked').value;
                    const multipleChoice = document.getElementById('multiple_choice');
                    const subjective = document.getElementById('subjective');
                    const fillInTheBlank = document.getElementById('fill_in_the_blank');
        
                    multipleChoice.style.display = type === 'multiple' ? 'block' : 'none';
                    subjective.style.display = type === 'subjective' ? 'block' : 'none';
                    fillInTheBlank.style.display = type === 'fill_in_the_blank' ? 'block' : 'none';
        
                    // if(type === 'fill_in_the_blank'){
                    //     resetBlanks()
                    //     generateAnswerFields()
                    // }
        
                    document.getElementsByName('mc_question')[0].disabled = type !== 'multiple';
                    document.getElementsByName('mc_choices[]').forEach(field => field.disabled = type !== 'multiple');
                    document.getElementsByName('mc_answers[]').forEach(field => field.disabled = type !== 'multiple');
                    document.getElementsByName('sub_question')[0].disabled = type !== 'subjective';
                    document.getElementsByName('sub_answer')[0].disabled = type !== 'subjective';
                    document.getElementsByName('fib_question')[0].disabled = type !== 'fill_in_the_blank';
                    document.getElementsByName('fib_answer[]').forEach(field => field.disabled = type !== 'fill_in_the_blank');
                }
        
                let originalBlanks = [];
                let previousAnswers = [];
                let initialQuestion = '';
        
                function generateAnswerFields() {
                    const textarea = document.getElementsByName('fib_question')[0];
                    const question = textarea.value;
                    const blankMatches = question.match(/{\s*}/g) || [];
                    const blanks = blankMatches.map(blank => blank.length - 2); // ÏõêÎûò Í≥µÎ∞± Ïàò Ï†ÄÏû•
                    const answerDiv = document.querySelector('#fib_answers');
        
                    // Í∏∞Ï°¥ Îß§ÌïëÏùÑ Ï†ÄÏû•
                    const existingAnswers = Array.from(document.getElementsByName('fib_answer[]')).map(input => input.value);
                    // Îß§ÌïëÏùÑ Ïú†ÏßÄÌïòÎ©∞ ÏÇ≠Ï†úÎêú blankÏóê ÎåÄÏùëÌïòÎäî Ï†ïÎãµ Ï†úÍ±∞
                    previousAnswers = previousAnswers.filter((_, index) => index < blanks.length);
        
                    if (answerDiv) {
                        answerDiv.innerHTML = '';
                        let updatedQuestion = question;
                        let currentAnswerIndex = 0;
        
                        for (let i = 0; i < blanks.length; i++) {
                            const label = document.createElement('label');
                            label.innerText = `Blank#${i + 1}: `;
                            const input = document.createElement('input');
                            input.type = 'text';
                            input.name = 'fib_answer[]';
                            input.required = true;
                            if (previousAnswers[currentAnswerIndex] !== undefined) {
                                input.value = previousAnswers[currentAnswerIndex];
                            } else if (existingAnswers[currentAnswerIndex] !== undefined) {
                                input.value = existingAnswers[currentAnswerIndex];
                            }
                            currentAnswerIndex++;
                            answerDiv.appendChild(label);
                            answerDiv.appendChild(input);
                            answerDiv.appendChild(document.createElement('br'));
        
                            updatedQuestion = updatedQuestion.replace(/{\s*}/, `{Blank#${i + 1}}`);
                        }
        
                        originalBlanks = blanks;
                        initialQuestion = updatedQuestion;
                        textarea.value = updatedQuestion;
                        document.querySelector('button[onclick="generateAnswerFields()"]').disabled = true; // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
        
                
                    } else {
                        console.error("Element with id 'fib_answers' not found.");
                    }
                }
        
                function resetBlanks() {
                    const textarea = document.getElementsByName('fib_question')[0];
                    const blankMatches = textarea.value.match(/{\s*Blank#\d+\s*}|{\s*}/g) || [];
        
                    if (blankMatches.length === 0) {
                        // ÎπàÏπ∏Ïù¥ ÌïòÎÇòÎèÑ ÏóÜÎäî Í≤ΩÏö∞ Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
                        document.querySelector('button[onclick="generateAnswerFields()"]').disabled = true;
                    } else {
                        // ÎπàÏπ∏Ïù¥ ÌïòÎÇòÎùºÎèÑ ÏûàÎäî Í≤ΩÏö∞ Î≤ÑÌäº ÌôúÏÑ±Ìôî
                        textarea.value = textarea.value.replace(/{\s*Blank#\d+\s*}|{\s*}/g, (match) => {
                            let blankCount;
                            if (match.includes('Blank#')) {
                                const blankNumber = parseInt(match.match(/\d+/)[0], 10) - 1;
                                blankCount = originalBlanks[blankNumber];
                            } else {
                                blankCount = match.length - 2; // Ï§ëÍ¥ÑÌò∏Î•º Ï†úÏô∏Ìïú Í≥µÎ∞± Ïàò
                            }
                            return `{${' '.repeat(blankCount)}}`;
                        });
                        document.querySelector('button[onclick="generateAnswerFields()"]').disabled = false; // Î≤ÑÌäº ÌôúÏÑ±Ìôî
                    }
                }
        
        
                function enableGenerateButton() {
                    const textarea = document.getElementsByName('fib_question')[0];
                    if (textarea.value === initialQuestion) {
                        document.querySelector('button[onclick="generateAnswerFields()"]').disabled = true;
                    } else {
                        document.querySelector('button[onclick="generateAnswerFields()"]').disabled = false;
                    }
                }
        
                function updateAnswerOptions() {
                    const choices = document.getElementsByName('mc_choices[]');
                    const answerDiv = document.getElementById('mc_answers');
                    answerDiv.innerHTML = '<h4>Ï†ïÎãµ</h4>';
        
        
                    choices.forEach((choice, index) => {
                        if (choice.value.trim() !== '') {
                            const label = document.createElement('label');
                            label.style.marginRight = '10px';
                            label.innerHTML = `<input type="checkbox" name="mc_answers[]" value="${index + 1}"> ${index + 1}`;
                            answerDiv.appendChild(label);
                        }
                    });
                }
        
                function isChecked(value) {
                    let answers = {{ question.Answers | default([]) | tojson }};
                    if (answers.length === 0 && '{{ question.Answer }}' !== '') {
                        answers = ['{{ question.Answer }}'];
                    }
                    return answers.includes(value.toString()) ? 'checked' : '';
                }
        
                function addChoice() {
                    const otherChoicesDiv = document.getElementById('other_choices');
                    const newChoice = document.createElement('div');
                    newChoice.innerHTML = `<textarea name="fib_others[]" rows="2"></textarea>`;
                    otherChoicesDiv.appendChild(newChoice);
                }
        
                function removeChoice() {
                    const otherChoicesDiv = document.getElementById('other_choices');
                    const choices = otherChoicesDiv.getElementsByTagName('div');
                    if (choices.length > 1) {
                        otherChoicesDiv.removeChild(choices[choices.length - 1]);
                    }
                }
        
                function loadCategories() {
                    fetch('/categories')
                        .then(response => response.json())
                        .then(data => {
                            const mainCategorySelect = document.getElementById('main_category');
                            mainCategorySelect.innerHTML = '<option value="">ÎåÄÎ∂ÑÎ•ò ÏÑ†ÌÉù</option>';
                            data.categories.forEach(category => {
                                const option = document.createElement('option');
                                option.value = category.name;
                                option.text = category.name;
                                mainCategorySelect.appendChild(option);
                            });
        
                            const category = {
                                main: "{{ question.Category.main if question.Category else '' }}",
                                sub: "{{ question.Category.sub if question.Category else '' }}",
                                minor: "{{ question.Category.minor if question.Category else '' }}"
                            };
                            if (category.main) {
                                mainCategorySelect.value = category.main;
                                updateSubcategories(() => {
                                    const subCategorySelect = document.getElementById('sub_category');
                                    if (category.sub) {
                                        subCategorySelect.value = category.sub;
                                        updateMinorCategories(() => {
                                            const minorCategorySelect = document.getElementById('minor_category');
                                            if (category.minor) {
                                                minorCategorySelect.value = category.minor;
                                            }
                                        });
                                    }
                                });
                            }
                        });
                }
        
                function updateSubcategories(callback) {
                    const mainCategory = document.getElementById('main_category').value;
                    fetch('/categories')
                        .then(response => response.json())
                        .then(data => {
                            const subCategorySelect = document.getElementById('sub_category');
                            subCategorySelect.innerHTML = '<option value="">Ï§ëÎ∂ÑÎ•ò ÏÑ†ÌÉù</option>';
                            const minorCategorySelect = document.getElementById('minor_category');
                            minorCategorySelect.innerHTML = '<option value="">ÏÜåÎ∂ÑÎ•ò ÏÑ†ÌÉù</option>';
                            const category = data.categories.find(category => category.name === mainCategory);
                            if (category) {
                                category.subcategories.forEach(subcategory => {
                                    const option = document.createElement('option');
                                    option.value = subcategory.name;
                                    option.text = subcategory.name;
                                    subCategorySelect.appendChild(option);
                                });
                            }
                            if (callback) callback();
                        });
                }
        
                function updateMinorCategories(callback) {
                    const mainCategory = document.getElementById('main_category').value;
                    const subCategory = document.getElementById('sub_category').value;
                    fetch('/categories')
                        .then(response => response.json())
                        .then(data => {
                            const minorCategorySelect = document.getElementById('minor_category');
                            minorCategorySelect.innerHTML = '<option value="">ÏÜåÎ∂ÑÎ•ò ÏÑ†ÌÉù</option>';
                            const category = data.categories.find(category => category.name === mainCategory);
                            if (category) {
                                const subcategory = category.subcategories.find(sub => sub.name === subCategory);
                                if (subcategory) {
                                    subcategory.subcategories.forEach(minor => {
                                        const option = document.createElement('option');
                                        option.value = minor.name;
                                        option.text = minor.name;
                                        minorCategorySelect.appendChild(option);
                                    });
                                }
                            }
                            if (callback) callback();
                        });
                }
        
                function validateForm(event) {
                    const questionType = document.querySelector('input[name="question_type"]:checked').value;
                    if (questionType === 'multiple') {
                        const answers = document.querySelectorAll('input[name="mc_answers[]"]:checked');
                        if (answers.length === 0) {
                            event.preventDefault();
                            alert('Í∞ùÍ¥ÄÏãù Î¨∏Ï†úÏùò Í≤ΩÏö∞, Ï†ÅÏñ¥ÎèÑ ÌïòÎÇòÏùò Ï†ïÎãµÏùÑ ÏÑ†ÌÉùÌï¥Ïïº Ìï©ÎãàÎã§.');
                        }
                    }
                }
        
                document.addEventListener('DOMContentLoaded', () => {
                    window.question = {{ question | tojson | safe }};
                    initialQuestion = document.getElementsByName('fib_question')[0].value
                    enableGenerateButton()
                    loadCategories();
                    document.getElementById('main_category').addEventListener('change', () => updateSubcategories());
                    document.getElementById('sub_category').addEventListener('change', () => updateMinorCategories());
                    updateAnswerOptions();
                    showForm();
                    const textarea = document.getElementsByName('fib_question')[0];
                    textarea.addEventListener('focus', resetBlanks);
                    textarea.addEventListener('input', enableGenerateButton);
                    document.querySelector('form').addEventListener('submit', validateForm);
                });
            </script>
        </head>
        
        <body>
            <h1 id="main-title">SSAT Ï∂úÏ†ú ÏãúÏä§ÌÖú</h1>
            <h1>Î¨∏Ï†ú ÏàòÏ†ï</h1>
        
            <div class="form-container">
                <form action="/edit/{{ question.ID }}" method="POST">
                    <label>
                        <input type="radio" name="question_type" value="multiple" onclick="showForm()" {% if
                            question.Type=='multiple' %}checked{% endif %}> Í∞ùÍ¥ÄÏãù
                    </label>
                    <label>
                        <input type="radio" name="question_type" value="subjective" onclick="showForm()" {% if
                            question.Type=='subjective' %}checked{% endif %}> Ï£ºÍ¥ÄÏãù
                    </label>
                    <label>
                        <input type="radio" name="question_type" value="fill_in_the_blank" onclick="showForm()" {% if
                            question.Type=='fill_in_the_blank' %}checked{% endif %}> ÎπàÏπ∏ Ï±ÑÏö∞Í∏∞
                    </label>
        
                    <div id="multiple_choice"
                        style="display: {% if question.Type == 'multiple' %}block{% else %}none{% endif %};">
                        <h3>Í∞ùÍ¥ÄÏãù Î¨∏Ï†ú</h3>
                        <label>Î¨∏Ï†ú: <textarea name="mc_question" rows="3" required>{{ question.Question }}</textarea></label><br>
                        <div id="choices">
                            {% if question.Choices %}
                            {% for choice in question.Choices %}
                            <div><label>{{ loop.index }}. <textarea name="mc_choices[]" rows="3" oninput="updateAnswerOptions()"
                                        required>{{ choice }}</textarea></label><br></div>
                            {% endfor %}
                            {% else %}
                            <div><label>1. <textarea name="mc_choices[]" rows="3" oninput="updateAnswerOptions()"
                                        required></textarea></label><br></div>
                            <div><label>2. <textarea name="mc_choices[]" rows="3" oninput="updateAnswerOptions()"
                                        required></textarea></label><br></div>
                            <div><label>3. <textarea name="mc_choices[]" rows="3" oninput="updateAnswerOptions()"
                                        required></textarea></label><br></div>
                            <div><label>4. <textarea name="mc_choices[]" rows="3" oninput="updateAnswerOptions()"
                                        required></textarea></label><br></div>
                            {% endif %}
                        </div>
                        <button type="button" onclick="addChoice()">Î≥¥Í∏∞ Ï∂îÍ∞Ä</button>
                        <button type="button" onclick="removeChoice()">Î≥¥Í∏∞ Ï†úÍ±∞</button><br>
                        <div id="mc_answers">
                            <h4>Ï†ïÎãµ</h4>
                        </div>
                    </div>
        
                    <div id="subjective" style="display: {% if question.Type == 'subjective' %}block{% else %}none{% endif %};">
                        <h3>Ï£ºÍ¥ÄÏãù Î¨∏Ï†ú</h3>
                        <label>Î¨∏Ï†ú: <textarea name="sub_question" rows="3"
                                required>{{ question.Question }}</textarea></label><br>
                        <label>Ï†ïÎãµ: <textarea name="sub_answer" rows="3"
                                required>{{ question.Answers[0] if question.Answers else question.Answer }}</textarea></label><br>
                    </div>
        
                    <div id="fill_in_the_blank"
                        style="display: {% if question.Type == 'fill_in_the_blank' %}block{% else %}none{% endif %};">
                        <h3>ÎπàÏπ∏ Ï±ÑÏö∞Í∏∞ Î¨∏Ï†ú</h3>
                        <label>Î¨∏Ï†ú: (ÏûëÏÑ±Ïòà: ÌïúÍµ≠Ïùò ÏàòÎèÑÎäî{ }Ïù¥Í≥†, ÎØ∏Íµ≠Ïùò ÏàòÎèÑÎäî { }Ïù¥Îã§.)<textarea name="fib_question" rows="3"
                                required>{{ question.Question }}</textarea></label><br>
                        <button type="button" onclick="generateAnswerFields()">Ï†ïÎãµ ÏûÖÎ†•</button><br><br>
                        
                        <div id="fib_answers">
                            {% if question.Type == 'fill_in_the_blank' %}
                                {% for key, value in question.Answers.items() %}
                                    {% if key.startswith('Blank#') %}
                                            <label>{{ key }}</label>
                                            <input name="fib_answer[]" type="text" value="{{value}}" required>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div id="other_choices">
                            <h4>Ïò§Îãµ Î≥¥Í∏∞ Ï∂îÍ∞Ä (ÏÑ†ÌÉù)</h4>
                            {% if question.Type == 'fill_in_the_blank' %}
                            {% for key, value in question.Answers.items() %}
                                {% if key.startswith('other#') %}
                                    <div>
                                        <textarea name="fib_others[]" rows="2">{{ value }}</textarea>
                                    </div> 
                                {% endif %}
                            {% endfor %}
                            {% endif %}
                        </div>
                        
                        <button type="button" onclick="addChoice()">Î≥¥Í∏∞ Ï∂îÍ∞Ä</button>
                        <button type="button" onclick="removeChoice()">Î≥¥Í∏∞ ÏÇ≠Ï†ú</button><br>
                    </div>
        
                    <h3>Î∂ÑÎ•ò</h3>
                    <label>ÎåÄÎ∂ÑÎ•ò:
                        <select id="main_category" name="main_category">
                            <option value="">ÎåÄÎ∂ÑÎ•ò ÏÑ†ÌÉù</option>
                        </select>
                    </label><br>
                    <label>Ï§ëÎ∂ÑÎ•ò:
                        <select id="sub_category" name="sub_category">
                            <option value="">Ï§ëÎ∂ÑÎ•ò ÏÑ†ÌÉù</option>
                        </select>
                    </label><br>
                    <label>ÏÜåÎ∂ÑÎ•ò:
                        <select id="minor_category" name="minor_category">
                            <option value="">ÏÜåÎ∂ÑÎ•ò ÏÑ†ÌÉù</option>
                        </select>
                    </label><br>
        
                    <label>Ï∂úÏ≤ò: <input type="text" name="source" value="{{ question.Source }}"></label><br>
                    <label>ÌÉúÍ∑∏: <textarea name="tags" rows="3">{{ question.Tags }}</textarea></label><br>
        
                    <input type="submit" value="ÏàòÏ†ï">
                </form>
                <form action="{{ url_for('index') }}" method="GET">
                    <button type="submit">Ï∑®ÏÜå</button>
                </form>
            </div>
        </body>
        
        </html>

        index.html
        ----------
        <!DOCTYPE html>
        <html lang="ko">
        
        <head>
            <meta charset="UTF-8">
            <title>Î¨∏Ï†úÎ•º Ï∂úÏ†ú Ìï¥ Ï£ºÏÑ∏Ïöî.</title>
            <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
            <script>
        
                function showForm() {
                    const selectedType = document.querySelector('input[name="question_type"]:checked');
                    if (!selectedType) return; // ÎùºÎîîÏò§ Î≤ÑÌäºÏù¥ ÏÑ†ÌÉùÎêòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ Ìï®Ïàò Ï¢ÖÎ£å
                    const type = selectedType.value;
                    const multipleChoice = document.getElementById('multiple_choice');
                    const subjective = document.getElementById('subjective');
                    const fillInTheBlank = document.getElementById('fill_in_the_blank');
        
                    multipleChoice.style.display = type === 'multiple' ? 'block' : 'none';
                    subjective.style.display = type === 'subjective' ? 'block' : 'none';
                    fillInTheBlank.style.display = type === 'fill_in_the_blank' ? 'block' : 'none';
        
                    document.getElementsByName('mc_question')[0].disabled = type !== 'multiple';
                    document.getElementsByName('mc_choices[]').forEach(field => field.disabled = type !== 'multiple');
                    document.getElementsByName('mc_answers[]').forEach(field => field.disabled = type !== 'multiple');
                    document.getElementsByName('sub_question')[0].disabled = type !== 'subjective';
                    document.getElementsByName('sub_answer')[0].disabled = type !== 'subjective';
                    document.getElementsByName('fib_question')[0].disabled = type !== 'fill_in_the_blank';
                    document.getElementsByName('fib_answer[]').forEach(field => field.disabled = type !== 'fill_in_the_blank');
                }
        
                let originalBlanks = [];
                let previousAnswers = [];
                let initialQuestion = '';
        
                function generateAnswerFields() {
                    const textarea = document.getElementsByName('fib_question')[0];
                    const question = textarea.value;
                    const blankMatches = question.match(/{\s*}/g) || [];
                    const blanks = blankMatches.map(blank => blank.length - 2); // ÏõêÎûò Í≥µÎ∞± Ïàò Ï†ÄÏû•
                    const answerDiv = document.querySelector('#fib_answers');
        
                    // Í∏∞Ï°¥ Îß§ÌïëÏùÑ Ï†ÄÏû•
                    const existingAnswers = Array.from(document.getElementsByName('fib_answer[]')).map(input => input.value);
        
                    // Îß§ÌïëÏùÑ Ïú†ÏßÄÌïòÎ©∞ ÏÇ≠Ï†úÎêú blankÏóê ÎåÄÏùëÌïòÎäî Ï†ïÎãµ Ï†úÍ±∞
                    previousAnswers = previousAnswers.filter((_, index) => index < blanks.length);
        
                    if (answerDiv) {
                        answerDiv.innerHTML = '';
                        let updatedQuestion = question;
                        let currentAnswerIndex = 0;
        
                        for (let i = 0; i < blanks.length; i++) {
                            const label = document.createElement('label');
                            label.innerText = `Blank#${i + 1}: `;
                            const input = document.createElement('input');
                            input.type = 'text';
                            input.name = 'fib_answer[]';
                            input.required = true;
                            if (previousAnswers[currentAnswerIndex] !== undefined) {
                                input.value = previousAnswers[currentAnswerIndex];
                            } else if (existingAnswers[currentAnswerIndex] !== undefined) {
                                input.value = existingAnswers[currentAnswerIndex];
                            }
                            currentAnswerIndex++;
                            answerDiv.appendChild(label);
                            answerDiv.appendChild(input);
                            answerDiv.appendChild(document.createElement('br'));
        
                            updatedQuestion = updatedQuestion.replace(/{\s*}/, `{Blank#${i + 1}}`);
                        }
        
                        originalBlanks = blanks;
                        initialQuestion = textarea.value;
                        textarea.value = updatedQuestion;
                        document.querySelector('button[onclick="generateAnswerFields()"]').disabled = true; // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
                    } else {
                        console.error("Element with id 'fib_answers' not found.");
                    }
                }
        
                function resetBlanks() {
                    const textarea = document.getElementsByName('fib_question')[0];
                    let i = 0;
                    textarea.value = textarea.value.replace(/{Blank#\d+}/g, (match) => {
                        const blankCount = originalBlanks[i++];
                        return `{${' '.repeat(blankCount)}}`;
                    });
                    document.querySelector('button[onclick="generateAnswerFields()"]').disabled = false; // Î≤ÑÌäº ÌôúÏÑ±Ìôî
                }
        
                function enableGenerateButton() {
                    const textarea = document.getElementsByName('fib_question')[0];
                    if (textarea.value === initialQuestion) {
                        document.querySelector('button[onclick="generateAnswerFields()"]').disabled = true;
                    } else {
                        document.querySelector('button[onclick="generateAnswerFields()"]').disabled = false;
                    }
                }
        
                document.addEventListener('DOMContentLoaded', () => {
                    showForm();
                    const textarea = document.getElementsByName('fib_question')[0];
                    textarea.addEventListener('focus', resetBlanks);
                    textarea.addEventListener('input', enableGenerateButton);
                });
        
                function updateAnswerOptions() {
                    const choices = document.getElementsByName('mc_choices[]');
                    const answerDiv = document.getElementById('mc_answers');
                    answerDiv.innerHTML = '<h4>Ï†ïÎãµ</h4>';
        
        
                    choices.forEach((choice, index) => {
                        if (choice.value.trim() !== '') {
                            const label = document.createElement('label');
                            label.style.marginRight = '10px';
                            label.innerHTML = `<input type="checkbox" name="mc_answers[]" value="${index + 1}"> ${index + 1}`;
                            answerDiv.appendChild(label);
                        }
                    });
                }
        
        
                function addChoice() {
                    const choicesDiv = document.getElementById('choices');
                    const choiceCount = choicesDiv.getElementsByTagName('label').length + 1;
                    const newChoice = document.createElement('div');
                    newChoice.innerHTML = `<label>${choiceCount}. <textarea name="mc_choices[]" rows="3" oninput="updateAnswerOptions()"></textarea></label><br>`;
                    choicesDiv.appendChild(newChoice);
                    updateAnswerOptions();
                }
        
        
                function removeChoice() {
                    const choicesDiv = document.getElementById('choices');
                    const choices = choicesDiv.getElementsByTagName('div');
                    if (choices.length > 2) {
                        choicesDiv.removeChild(choices[choices.length - 1]);
                        updateAnswerOptions();
                    }
                }
        
        
                function openPopup() {
                    document.getElementById('voc-popup').style.display = 'block';
                    document.getElementById('voc-popup-overlay').style.display = 'block';
                }
        
        
                function closePopup() {
                    document.getElementById('voc-popup').style.display = 'none';
                    document.getElementById('voc-popup-overlay').style.display = 'none';
                }
        
        
                function loadCategories() {
                    fetch('/categories')
                        .then(response => response.json())
                        .then(data => {
                            const mainCategorySelect = document.getElementById('main_category');
                            mainCategorySelect.innerHTML = '<option value="">ÎåÄÎ∂ÑÎ•ò ÏÑ†ÌÉù</option>';
                            data.categories.forEach(category => {
                                const option = document.createElement('option');
                                option.value = category.name;
                                option.text = category.name;
                                mainCategorySelect.appendChild(option);
                            });
        
        
                            const lastMainCategory = '{{ request.cookies.get("last_main_category", "") }}';
                            const lastSubCategory = '{{ request.cookies.get("last_sub_category", "") }}';
                            const lastMinorCategory = '{{ request.cookies.get("last_minor_category", "") }}';
        
        
                            if (lastMainCategory) {
                                mainCategorySelect.value = lastMainCategory;
                                updateSubcategories(() => {
                                    const subCategorySelect = document.getElementById('sub_category');
                                    if (lastSubCategory) {
                                        subCategorySelect.value = lastSubCategory;
                                        updateMinorCategories(() => {
                                            const minorCategorySelect = document.getElementById('minor_category');
                                            if (lastMinorCategory) {
                                                minorCategorySelect.value = lastMinorCategory;
                                            }
                                        });
                                    }
                                });
                            }
                        });
                }
        
        
                function updateSubcategories(callback) {
                    const mainCategory = document.getElementById('main_category').value;
                    fetch('/categories')
                        .then(response => response.json())
                        .then(data => {
                            const subCategorySelect = document.getElementById('sub_category');
                            subCategorySelect.innerHTML = '<option value="">Ï§ëÎ∂ÑÎ•ò ÏÑ†ÌÉù</option>';
                            const minorCategorySelect = document.getElementById('minor_category');
                            minorCategorySelect.innerHTML = '<option value="">ÏÜåÎ∂ÑÎ•ò ÏÑ†ÌÉù</option>';
                            const category = data.categories.find(category => category.name === mainCategory);
                            if (category) {
                                category.subcategories.forEach(subcategory => {
                                    const option = document.createElement('option');
                                    option.value = subcategory.name;
                                    option.text = subcategory.name;
                                    subCategorySelect.appendChild(option);
                                });
                            }
                            if (callback) callback();
                        });
                }
        
        
                function updateMinorCategories(callback) {
                    const mainCategory = document.getElementById('main_category').value;
                    const subCategory = document.getElementById('sub_category').value;
                    fetch('/categories')
                        .then(response => response.json())
                        .then(data => {
                            const minorCategorySelect = document.getElementById('minor_category');
                            minorCategorySelect.innerHTML = '<option value="">ÏÜåÎ∂ÑÎ•ò ÏÑ†ÌÉù</option>';
                            const category = data.categories.find(category => category.name === mainCategory);
                            if (category) {
                                const subcategory = category.subcategories.find(sub => sub.name === subCategory);
                                if (subcategory) {
                                    subcategory.subcategories.forEach(minor => {
                                        const option = document.createElement('option');
                                        option.value = minor.name;
                                        option.text = minor.name;
                                        minorCategorySelect.appendChild(option);
                                    });
                                }
                            }
                            if (callback) callback();
                        });
                }
        
        
                function validateForm(event) {
                    const questionType = document.querySelector('input[name="question_type"]:checked').value;
                    if (questionType === 'multiple') {
                        const answers = document.querySelectorAll('input[name="mc_answers[]"]:checked');
                        if (answers.length === 0) {
                            event.preventDefault();
                            alert('Í∞ùÍ¥ÄÏãù Î¨∏Ï†úÏùò Í≤ΩÏö∞, Ï†ÅÏñ¥ÎèÑ ÌïòÎÇòÏùò Ï†ïÎãµÏùÑ ÏÑ†ÌÉùÌï¥Ïïº Ìï©ÎãàÎã§.');
                        }
                    }
                }
        
        
                document.addEventListener('DOMContentLoaded', () => {
                    loadCategories();
                    document.getElementById('main_category').addEventListener('change', () => updateSubcategories());
                    document.getElementById('sub_category').addEventListener('change', () => updateMinorCategories());
                    document.querySelector('form').addEventListener('submit', validateForm);
                    showForm();
                });
            </script>
            <style>
                .popup {
                    display: none;
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    width: 40%;
                    background-color: white;
                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                    padding: 20px;
                    z-index: 1000;
                    border-radius: 8px;
                }
        
        
                .popup-overlay {
                    display: none;
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.7);
                    z-index: 999;
                }
        
        
                .popup-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
        
        
                .popup-header h2 {
                    margin: 0;
                }
        
        
                .popup-header .close {
                    cursor: pointer;
                    font-size: 1.5em;
                }
        
        
                #feedback-button,
                #download-users-button {
                    position: fixed;
                    bottom: 20px;
                    padding: 10px 20px;
                    background-color: #007bff;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                }
        
        
                #feedback-button:hover,
                #download-users-button:hover {
                    background-color: #0056b3;
                }
        
        
                #feedback-button {
                    right: 20px;
                }
        
        
                #download-users-button {
                    right: 220px;
                }
        
        
                body {
                    padding: 0 10%;
                }
        
        
                textarea {
                    resize: vertical;
                }
        
        
                .title-container {
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    margin-bottom: 20px;
                }
        
        
                .title-container h2 {
                    margin: 0;
                }
        
        
                .title-container .download-btn {
                    margin-left: 10px;
                }
        
        
                .admin-btns {
                    display: flex;
                    justify-content: center;
                    margin-bottom: 20px;
                }
        
        
                .admin-btns .download-btn {
                    margin: 0 10px;
                }
        
        
                .questions-list {
                    max-width: 800px;
                    margin: 0 auto;
                }
        
        
                .form-container {
                    max-width: 800px;
                    margin: 0 auto;
                }
        
        
                #mc_answers label {
                    display: inline-block;
                    margin-right: 10px;
                }
        
        
                .chart-container {
                    margin-top: 40px;
                    text-align: center;
                }
        
        
                .chart-title {
                    text-align: center;
                    margin-bottom: 20px;
                }
                #inputArea {
                    /* width: 100%; */
                    height: 100px;
                }
                #preview img {
                    margin-top: 10px;
                    max-width: 300px;  /* Ïù¥ÎØ∏ÏßÄÏùò ÏµúÎåÄ ÎÑàÎπÑÎ•º 100pxÎ°ú ÏÑ§Ï†ï */
                    max-height: 300px; /* Ïù¥ÎØ∏ÏßÄÏùò ÏµúÎåÄ ÎÜíÏù¥Î•º 100pxÎ°ú ÏÑ§Ï†ï */
                }
            </style>
        </head>
        
        <body>
            <h1 id="main-title">SSAT Ï∂úÏ†ú ÏãúÏä§ÌÖú</h1>
            <h1>Î¨∏Ï†úÎ•º Ï∂úÏ†ú Ìï¥ Ï£ºÏÑ∏Ïöî.</h1>
        
        
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <ul class="flashes">
                {% for category, message in messages %}
                <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
            {% endif %}
            {% endwith %}
        
        
            <p>ÌôòÏòÅÌï©ÎãàÎã§, {{ user.id }}Îãò! <a href="{{ url_for('logout') }}">Î°úÍ∑∏ÏïÑÏõÉ</a> | <a
                    href="{{ url_for('change_password') }}">ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω</a></p>
        
        
            {% if user.id == 'admin' %}
            <p><a href="{{ url_for('manage_categories') }}">Î∂ÑÎ•ò Í¥ÄÎ¶¨</a></p>
            {% endif %}
        
        
            <form action="/submit" method="POST" class="form-container">
                <label>
                    <input type="radio" name="question_type" value="multiple" onclick="showForm()" {% if last_type=='multiple'
                        or last_type is none %}checked{% endif %}> Í∞ùÍ¥ÄÏãù
                </label>
                <label>
                    <input type="radio" name="question_type" value="subjective" onclick="showForm()" {% if
                        last_type=='subjective' %}checked{% endif %}> Ï£ºÍ¥ÄÏãù
                </label>
                <label>
                    <input type="radio" name="question_type" value="fill_in_the_blank" onclick="showForm()" {% if
                        last_type=='fill_in_the_blank' %}checked{% endif %}> ÎπàÏπ∏ Ï±ÑÏö∞Í∏∞
                </label>
        
        
        
                <h1>Paste Image in Text Area</h1>
                <textarea id="inputArea" placeholder="Paste text or image here..."></textarea>
                <div id="preview"></div>
            
                <script>
                    document.getElementById('inputArea').addEventListener('paste', function (event) {
                        const items = (event.clipboardData || event.originalEvent.clipboardData).items;
                        for (const item of items) {
                            if (item.kind === 'file' && item.type.startsWith('image/')) {
                                const blob = item.getAsFile();
                                const reader = new FileReader();
                                reader.onload = function (event) {
                                    const img = document.createElement('img');
                                    img.src = event.target.result;
                                    document.getElementById('preview').appendChild(img);
                                };
                                reader.readAsDataURL(blob);
                            }
                        }
                    });
                </script>
        
        
                <div id="multiple_choice"
                    style="display: {% if last_type == 'multiple' or last_type is none %}block{% else %}none{% endif %};">
                    <h3>Í∞ùÍ¥ÄÏãù Î¨∏Ï†ú</h3>
                    <div id="question">
                        <label for="mc_question">Î¨∏Ï†ú:</label>
                    </div>
                    <div id="question">
                        <textarea name="mc_question" id="mc_question" rows="3" required></textarea>
                    </div>
                    <div id="choices">
                        <div><label>1. <textarea name="mc_choices[]" rows="3" oninput="updateAnswerOptions()"
                                    required></textarea></label><br></div>
                        <div><label>2. <textarea name="mc_choices[]" rows="3" oninput="updateAnswerOptions()"
                                    required></textarea></label><br></div>
                        <div><label>3. <textarea name="mc_choices[]" rows="3" oninput="updateAnswerOptions()"
                                    required></textarea></label><br></div>
                        <div><label>4. <textarea name="mc_choices[]" rows="3" oninput="updateAnswerOptions()"
                                    required></textarea></label><br></div>
                    </div>
                    <button type="button" onclick="addChoice()">Î≥¥Í∏∞ Ï∂îÍ∞Ä</button>
                    <button type="button" onclick="removeChoice()">Î≥¥Í∏∞ Ï†úÍ±∞</button><br>
                    <div id="mc_answers">
                        <h4>Ï†ïÎãµ</h4>
                    </div>
                </div>
        
        
                <div id="subjective" style="display: {% if last_type == 'subjective' %}block{% else %}none{% endif %};">
                    <h3>Ï£ºÍ¥ÄÏãù Î¨∏Ï†ú</h3>
                    <label>Î¨∏Ï†ú: <textarea name="sub_question" rows="3" required></textarea></label><br>
                    <label>Ï†ïÎãµ: <textarea name="sub_answer" rows="3" required></textarea></label><br>
                </div>
        
                <div id="fill_in_the_blank" style="display: {% if last_type == 'fill_in_the_blank' %}block{% else %}none{% endif %};">
                    <h3>ÎπàÏπ∏ Ï±ÑÏö∞Í∏∞ Î¨∏Ï†ú</h3>
                    <label>Î¨∏Ï†ú:  (ÏûëÏÑ±Ïòà: ÌïúÍµ≠Ïùò ÏàòÎèÑÎäî{ }Ïù¥Í≥†, ÎØ∏Íµ≠Ïùò ÏàòÎèÑÎäî { }Ïù¥Îã§.)<textarea name="fib_question" rows="3" required></textarea></label><br>
                    <button type="button" onclick="generateAnswerFields()">Ï†ïÎãµ ÏûÖÎ†•</button><br><br>
                    <div id="fib_answers"></div>
                    <div id="other_choices">
                        <h4>Ïò§Îãµ Î≥¥Í∏∞ Ï∂îÍ∞Ä (ÏÑ†ÌÉù)</h4>
                        <div>
                            <textarea name="fib_others[]" rows="2"></textarea>
                        </div>
                    </div>
                    <button type="button" onclick="addChoice()">Î≥¥Í∏∞ Ï∂îÍ∞Ä</button>
                    <button type="button" onclick="removeChoice()">Î≥¥Í∏∞ ÏÇ≠Ï†ú</button><br>
                </div>
                
                <script>
                    function addChoice() {
                        const otherChoicesDiv = document.getElementById('other_choices');
                        const newChoice = document.createElement('div');
                        newChoice.innerHTML = `<textarea name="fib_others[]" rows="2"></textarea>`;
                        otherChoicesDiv.appendChild(newChoice);
                    }
                
                    function removeChoice() {
                        const otherChoicesDiv = document.getElementById('other_choices');
                        const choices = otherChoicesDiv.getElementsByTagName('div');
                        if (choices.length > 1) {
                            otherChoicesDiv.removeChild(choices[choices.length - 1]);
                        }
                    }
                </script>
        
                <h3>Î∂ÑÎ•ò</h3>
                <label>ÎåÄÎ∂ÑÎ•ò:
                    <select id="main_category" name="main_category">
                        <option value="">ÎåÄÎ∂ÑÎ•ò ÏÑ†ÌÉù</option>
                    </select>
                </label><br>
                <label>Ï§ëÎ∂ÑÎ•ò:
                    <select id="sub_category" name="sub_category">
                        <option value="">Ï§ëÎ∂ÑÎ•ò ÏÑ†ÌÉù</option>
                    </select>
                </label><br>
                <label>ÏÜåÎ∂ÑÎ•ò:
                    <select id="minor_category" name="minor_category">
                        <option value="">ÏÜåÎ∂ÑÎ•ò ÏÑ†ÌÉù</option>
                    </select>
                </label><br>
        
        
                <label>Ï∂úÏ≤ò: <input type="text" name="source" value="{{ request.cookies.get('last_source', '') }}"></label><br>
                <label>ÌÉúÍ∑∏: <textarea name="tags" rows="3">{{ last_tags }}</textarea></label><br>
        
        
                <input type="submit" value="Ï†úÏ∂ú">
            </form>
        
        
            <button id="feedback-button" onclick="openPopup()">Í∏∞Îä•Ï†úÏïà Î∞è Î≤ÑÍ∑∏Ïã†Í≥†</button>
            {% if user.id == 'admin' %}
            <button id="download-users-button" onclick="window.location.href='{{ url_for('download_users') }}'">USER Î™©Î°ù
                Îã§Ïö¥Î°úÎìú</button>
            {% endif %}
        
        
            <div id="voc-popup" class="popup">
                <div class="popup-header">
                    <h2>Í∏∞Îä•Ï†úÏïà Î∞è Î≤ÑÍ∑∏Ïã†Í≥†</h2>
                    <span class="close" onclick="closePopup()">&times;</span>
                </div>
                <form action="/submit_voc" method="POST" class="voc-container">
                    <label for="voc_type">Ïú†Ìòï:</label>
                    <select id="voc_type" name="voc_type" required>
                        <option value="Feature Suggestion">Í∏∞Îä• Ï†úÏïà</option>
                        <option value="Bug Report">Î≤ÑÍ∑∏ Ïã†Í≥†</option>
                    </select><br>
                    <label for="voc_content">ÎÇ¥Ïö©:</label>
                    <textarea id="voc_content" name="voc_content" rows="4" required></textarea><br>
                    <input type="submit" value="Ï†úÏ∂ú">
                </form>
                {% if user.id == 'admin' %}
                <a href="{{ url_for('download_voc') }}" class="download-btn" style="float: right;">VOC JSON Îã§Ïö¥Î°úÎìú</a>
                {% endif %}
            </div>
            <div id="voc-popup-overlay" class="popup-overlay" onclick="closePopup()"></div>
        
        
            <div class="container">
                <div class="title-container">
                    <h2>Î¨∏Ï†ú Î™©Î°ù</h2>
                    {% if user.id == 'admin' %}
                    <a href="{{ url_for('download') }}" class="download-btn">JSON Îã§Ïö¥Î°úÎìú</a>
                    {% endif %}
                </div>
                <div class="question-count">Î¨∏Ï†ú Ïàò: {{ questions | length }}</div> <br> <!-- Î¨∏Ï†ú Ïàò ÌëúÏãú -->
                <div class="questions-list">
                    {% if questions %}
                    {% for question in questions %}
                    <div class="question">
                        <p><strong>ID:</strong> {{ question.ID }}</p>
                        <p><strong>Ïú†Ìòï:</strong> {{ question.Type }}</p>
                        <p><strong>Î¨∏Ï†ú:</strong> {{ question.Question }}</p>
                        {% if question.Choices %}
                        <p><strong>Î≥¥Í∏∞:</strong></p>
                        <ul>
                            {% for choice in question.Choices %}
                            <li>{{ choice }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                        <p><strong>Ï†ïÎãµ:</strong>
                            {% if question.Type == 'fill_in_the_blank' %}
                        <ul>
                            {% if question.Answers is mapping %}
                            {% for key, value in question.Answers.items() %}
                            <li>{{ key }}: {{ value }}</li>
                            {% endfor %}
                            {% else %}
                            {% for answer in question.Answers %}
                            <li>{{ answer }}</li>
                            {% endfor %}
                            {% endif %}
                        </ul>
                        {% else %}
                        <ul>
                            {% for answer in question.Answers %}
                            <li>{{ answer }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                        </p>
                        <p><strong>ÎåÄÎ∂ÑÎ•ò:</strong> {{ question.Category.main if question.Category else '' }}</p>
                        <p><strong>Ï§ëÎ∂ÑÎ•ò:</strong> {{ question.Category.sub if question.Category else '' }}</p>
                        <p><strong>ÏÜåÎ∂ÑÎ•ò:</strong> {{ question.Category.minor if question.Category else '' }}</p>
                        <p><strong>ÌÉúÍ∑∏:</strong> {{ question.Tags }}</p>
                        <p><strong>Ï∂úÏ≤ò:</strong> {{ question.Source }}</p>
                        <p><strong>Ï†úÏ∂úÏûê ID:</strong> {{ question.SubmitterID }}</p>
                        <p><strong>Ï†úÏ∂ú ÏãúÍ∞Ñ:</strong> {{ question.SubmissionTime }}</p>
                        <p><strong>ÎßàÏßÄÎßâ ÏàòÏ†ï ÏãúÍ∞Ñ:</strong> {{ question.LastModifiedTime }}</p>
                        <form action="{{ url_for('edit_question', question_id=question.ID) }}" method="GET"
                            style="display:inline;">
                            <button type="submit">ÏàòÏ†ï</button>
                        </form>
                        <form action="{{ url_for('delete_question', question_id=question.ID) }}" method="POST"
                            style="display:inline;">
                            <button type="submit">ÏÇ≠Ï†ú</button>
                        </form>
                        <hr>
                    </div>
                    {% endfor %}
                    {% else %}
                    <p>ÏïÑÏßÅ Ï†úÏ∂úÎêú ÏßàÎ¨∏Ïù¥ ÏóÜÏäµÎãàÎã§.</p>
                    {% endif %}
                </div>
        
            </div>
        
        
            <div class="chart-container">
                <h2 class="chart-title">Ï∂úÏ†ú ÌòÑÌô© (Total: {{ total_questions }})</h2>
                <img src="data:image/png;base64,{{ chart_base64 }}" alt="Ï∂úÏ†ú ÌòÑÌô©">
            </div>
        </body>
        
        </html>

        register.html
        -------------
        <!DOCTYPE html>
        <html lang="ko">
        <head>
           <meta charset="UTF-8">
           <title>ÌöåÏõêÍ∞ÄÏûÖ</title>
           <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
        </head>
        <body>
           <div class="form-container">
               <h1>SSAT Ï∂úÏ†ú ÏãúÏä§ÌÖú</h1>
               <h1>ÌöåÏõêÍ∞ÄÏûÖ</h1>
        
        
               {% with messages = get_flashed_messages(with_categories=true) %}
                   {% if messages %}
                       <ul class="flashes">
                           {% for category, message in messages %}
                               <li class="{{ category }}">{{ message }}</li>
                           {% endfor %}
                       </ul>
                   {% endif %}
               {% endwith %}
        
        
               <form action="{{ url_for('register') }}" method="POST">
                   <label>ÏÇ¨Ïö©Ïûê ID: <input type="text" name="user_id" required></label><br>
                   <label>ÎπÑÎ∞ÄÎ≤àÌò∏: <input type="password" name="password" required></label><br>
                   <input type="submit" value="ÌöåÏõêÍ∞ÄÏûÖ">
               </form>
               <p class="switch-form">Ïù¥ÎØ∏ Í≥ÑÏ†ïÏù¥ ÏûàÏúºÏã†Í∞ÄÏöî? <a href="{{ url_for('login') }}">Î°úÍ∑∏Ïù∏</a></p>
           </div>
        </body>
        </html>

        change_password.html
        --------------------
        <!DOCTYPE html>
        <html lang="ko">
        <head>
           <meta charset="UTF-8">
           <title>ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω</title>
           <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
        </head>
        <body>
           <div class="form-container">
               <h1>SSAT Ï∂úÏ†ú ÏãúÏä§ÌÖú</h1>
               <h1>ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω</h1>
        
        
               {% with messages = get_flashed_messages(with_categories=true) %}
                   {% if messages %}
                       <ul class="flashes">
                           {% for category, message in messages %}
                               <li class="{{ category }}">{{ message }}</li>
                           {% endfor %}
                       </ul>
                   {% endif %}
               {% endwith %}
        
        
               <form action="{{ url_for('change_password') }}" method="POST">
                   <label>Í∏∞Ï°¥ ÎπÑÎ∞ÄÎ≤àÌò∏: <input type="password" name="old_password" required></label><br>
                   <label>ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏: <input type="password" name="new_password" required></label><br>
                   <label>ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏: <input type="password" name="confirm_password" required></label><br>
                   <input type="submit" value="Î≥ÄÍ≤Ω">
               </form>
               <form action="{{ url_for('index') }}" method="GET">
                   <button type="submit">Ï∑®ÏÜå</button>
               </form>
           </div>
        </body>
        </html>

        login.html
        ----------
        <!DOCTYPE html>
        <html lang="ko">
        <head>
           <meta charset="UTF-8">
           <title>Î°úÍ∑∏Ïù∏</title>
           <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
        </head>
        <body>
           <div class="form-container">
               <h1>SSAT Ï∂úÏ†ú ÏãúÏä§ÌÖú</h1>
               <h1>Î°úÍ∑∏Ïù∏</h1>
        
        
               {% with messages = get_flashed_messages(with_categories=true) %}
                   {% if messages %}
                       <ul class="flashes">
                           {% for category, message in messages %}
                               <li class="{{ category }}">{{ message }}</li>
                           {% endfor %}
                       </ul>
                   {% endif %}
               {% endwith %}
        
        
               <form action="{{ url_for('login') }}" method="POST">
                   <label>ÏÇ¨Ïö©Ïûê ID: <input type="text" name="user_id" required></label><br>
                   <label>ÎπÑÎ∞ÄÎ≤àÌò∏: <input type="password" name="password" required></label><br>
                   <input type="submit" value="Î°úÍ∑∏Ïù∏">
               </form>
               <p class="switch-form">Í≥ÑÏ†ïÏù¥ ÏóÜÏúºÏã†Í∞ÄÏöî? <a href="{{ url_for('register') }}">ÌöåÏõêÍ∞ÄÏûÖ</a></p>
           </div>
        </body>
        </html>

    static/
        styles.css
        ----------
        body {
           font-family: Arial, sans-serif;
           background-color: #f5f5f5;
           margin: 0;
           padding: 0;
        }
        
        
        h1, h2 {
           text-align: center;
           margin-top: 20px;
        }
        
        
        .form-container {
           max-width: 800px;
           margin: 20px auto;
           padding: 20px;
           border: 1px solid #ccc;
           border-radius: 5px;
           background-color: #fff;
        }
        
        
        form {
           width: 100%;
           margin: 0 auto;
           padding: 20px 0;
        }
        
        
        label {
           display: block;
           margin-bottom: 10px;
        }
        
        
        input[type="text"],
        input[type="password"],
        input[type="number"],
        textarea {
           /* width: 100%; */
           padding: 8px;
           margin-top: 5px;
           margin-bottom: 20px;
           border: 1px solid #ccc;
           border-radius: 4px;
        }
        
        
        input[type="radio"] {
           margin-right: 10px;
        }
        
        
        button {
           padding: 10px 20px;
           margin-right: 10px;
           border: none;
           border-radius: 4px;
           background-color: #007bff;
           color: white;
           cursor: pointer;
        }
        
        
        button:hover {
           background-color: #0056b3;
        }
        
        
        input[type="submit"] {
           width: 100%;
           padding: 10px;
           border: none;
           border-radius: 4px;
           background-color: #28a745;
           color: white;
           cursor: pointer;
           font-size: 16px;
        }
        
        
        input[type="submit"]:hover {
           background-color: #218838;
        }
        
        
        .switch-form {
           text-align: center;
           margin-top: 20px;
        }
        
        
        #multiple_choice,
        #subjective {
           margin-top: 20px;
        }
        
        
        #choices label {
           display: flex;
           align-items: center;
        }
        
        
        #choices textarea {
           flex: 1;
           margin-left: 10px;
           margin-bottom: -20px;
        }
        
        #question {
           display: flex;
           margin-bottom: 20px;
        }
        
        #question label {
           display: block;
           margin-bottom: -20px;
        }
        
        
        #question textarea {
           flex: 1;
        }
        
        .flashes {
           list-style-type: none;
           padding: 0;
           margin: 20px auto;
           width: 50%;
           text-align: center;
        }
        
        
        .flashes li {
           padding: 10px;
           border-radius: 5px;
           margin-bottom: 10px;
           color: white;
        }
        
        
        .flashes li.success {
           background-color: #28a745;
        }
        
        
        .flashes li.error {
           background-color: #dc3545;
        }
        
        
        .container {
           max-width: 800px; /* Ïª®ÌÖåÏù¥ÎÑàÏùò ÏµúÎåÄ ÎÑàÎπÑÎ•º ÏÑ§Ï†ï */
           margin: 20px auto;
           padding: 20px;
           border: 1px solid #ccc;
           border-radius: 5px;
           background-color: #fff;
        }
        
        
        .questions-list {
           max-height: 400px;
           overflow-y: auto;
        }
        
        
        .question {
           margin-bottom: 20px;
        }
        
        
        .download-btn {
           display: inline-block;
           margin: 10px 0;
           padding: 10px 20px;
           border-radius: 4px;
           background-color: #007bff;
           color: white;
           text-decoration: none;
           cursor: pointer;
        }
        
        
        .download-btn:hover {
           background-color: #0056b3;
        }
        
        
        .popup {
           display: none;
           position: fixed;
           top: 50%;
           left: 50%;
           transform: translate(-50%, -50%);
           width: 40%;
           background-color: white;
           box-shadow: 0 5px 15px rgba(0,0,0,0.3);
           padding: 20px;
           z-index: 1000;
           border-radius: 8px;
        }
        
        
        .popup-overlay {
           display: none;
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: rgba(0,0,0,0.7);
           z-index: 999;
        }
        
        
        .popup-header {
           display: flex;
           justify-content: space-between;
           align-items: center;
        }
        
        
        .popup-header h2 {
           margin: 0;
        }
        
        
        .popup-header .close {
           cursor: pointer;
           font-size: 1.5em;
        }
        
        
        #feedback-button {
           position: fixed;
           bottom: 20px;
           right: 20px;
           padding: 10px 20px;
           background-color: #007bff;
           color: white;
           border: none;
           border-radius: 4px;
           cursor: pointer;
           box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        
        #feedback-button:hover {
           background-color: #0056b3;
        }
        
        
        body {
           padding: 0 10%;
        }
        
        
        textarea {
           resize: vertical;
        }
        
        
        .title-container {
           display: flex;
           justify-content: center;
           align-items: center;
           margin-bottom: 20px;
        }
        
        
        .title-container h2 {
           margin: 0;
        }
        
        
        .title-container .download-btn {
           margin-left: 10px;
        }
        
        
        .admin-btns {
           display: flex;
           justify-content: center;
           margin-bottom: 20px;
        }
        
        
        .admin-btns .download-btn {
           margin: 0 10px;
        }
        
        
        .questions-list {
           max-width: 800px;
           margin: 0 auto;
        }
        
        
        .form-container {
           max-width: 800px;
           margin: 0 auto;
        }
        
        
        #mc_answers label {
           display: inline-block;
           margin-right: 10px;
        }
